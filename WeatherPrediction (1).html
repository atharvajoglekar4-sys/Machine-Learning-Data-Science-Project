import datetime, warnings, scipy 
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.neighbors import KNeighborsClassifier
from sklearn.metrics import accuracy_score
warnings.filterwarnings("ignore")
df = pd.read_csv('Airline-dataset1.csv')
df_train = pd.DataFrame(df)
df_train['Weather'] = df_train['Weather'].apply(lambda x: 0 if x == 'sunny' else (1 if x == 'cloudy' else (2 if x == 'ice' else (3 if x == 'snowy' else (4 if x == 'Tstorms' else (5 if x == 'calm' else 6)))))) 
# for now, I'm not taking the Airline,Date,Origin,Destination,DepTime and other non-numeric columns into X as they need to be first converted into int/flow. 
# source data for training
X = df_train['Weather'].to_frame()

# the 'target' 
y = df_train['DelayedYN']

# split the data into training and testing 
X_train, X_test, y_train, y_test = train_test_split(X, y, random_state = 3)

# using an unsupervised algorithm. We should try others and compare the results. 
knn = KNeighborsClassifier(n_neighbors=3)
knn.fit(X_train, y_train)

# run the prediction on test data
y_pred = knn.predict(X_test)
print(y_pred)   # check the output with the input data and there may be some incorrect predictions given the small data size

# one metric to get confidence level of the prediction without looking at the output data    
accuracy = accuracy_score(y_test, y_pred)
print(f"Accuracy: {accuracy}")
#visualizing metrics to see a certain relationship between weather and delays
sns.barplot(x='Weather', y='DEP_DELAY', data=df, estimator='mean', ci=None)
plt.title('Average Departure Delay by Weather Condition')
plt.ylabel('Departure Delay (minutes)')
plt.show()
#now using a boxplot
sns.boxplot(x='Weather', y='DEP_DELAY', data=df)
plt.title('Departure Delay Distribution by Weather')
plt.ylabel('Departure Delay (minutes)')
plt.show()
